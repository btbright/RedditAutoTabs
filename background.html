<html>
  <head>
    <script>
      //Display the page action when the user is on reddit
      chrome.tabs.onUpdated.addListener(checkForReddit);
      var checkForReddit = function (tabId, changeInfo, tab) {
        if (tab.url.indexOf('reddit.com') > -1) {
          // ... show the page action.
          chrome.pageAction.show(tabId);
        }
      };

      //When the user is on reddit and clicks the pageAction button
      //ask the content script to find all the urls and report back
			chrome.pageAction.onClicked.addListener(findUrls);
      var findUrls = function(tab) {
        chrome.tabs.executeScript(null, {file: "contentscript.js"});
      };
			
      //When the content script reports back the urls, open them
			chrome.extension.onRequest.addListener(openUrls);
      var openUrls = function(urls) {
        var urlsLen = urls;
        for (var i=0;i<urlsLen;i++){
          chrome.tabs.create({url:urls[i],selected:false});
        }
      };
    </script>
  </head>
</html>